#!/usr/bin/perl

use warnings;
use strict;

use App::SCM::Digest;

use Getopt::Long;
use YAML;

sub load_config
{
    my ($path) = @_;

    my $config = YAML::LoadFile($path);
    return $config;
}

sub main
{
    my %options;
    GetOptions(\%options, 'conf=s', 'update', 'send', 'from', 'to');

    my $config_path = $options{'conf'} || '/etc/scm-digest.conf';
    my $config = load_config($config_path);

    my $app = App::SCM::Digest->new($config);

    if ($options{'update'}) {
        $app->update();
    } elsif ($options{'send'}) {
        $app->send($options{'from'}, $options{'to'});
    } else {
        die "invalid options";
    }
}

main();

1;

__END__
